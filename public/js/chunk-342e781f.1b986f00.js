(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-342e781f"],{3573:function(t,e,a){"use strict";var i=a("ac1b"),r=a("5b7f"),n=a("3a08"),s="startsWith",o=""[s];i(i.P+i.F*a("7d31")(s),"String",{startsWith:function(t){var e=n(this,t,s),a=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),i=String(t);return o?o.call(e,i,a):e.slice(a,a+i.length)===i}})},"3a08":function(t,e,a){var i=a("f83a"),r=a("346b");t.exports=function(t,e,a){if(i(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(r(t))}},"3cfd":function(t,e,a){},"44dd":function(t,e,a){t.exports=a("67a8")},"67a8":function(t,e,a){a("0862"),a("a8ce"),t.exports=a("68bb")},"68bb":function(t,e,a){var i=a("90a5"),r=a("0749");t.exports=a("332a").getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},"7d31":function(t,e,a){var i=a("b816")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[i]=!1,!"/./"[t](e)}catch(r){}}return!0}},ea50:function(t,e,a){"use strict";var i=a("3cfd"),r=a.n(i);r.a},eace:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container",staticStyle:{margin:"15px 15px"}},[a("el-row",{staticStyle:{"font-size":"16px",color:"#303133"},attrs:{type:"flex",justify:"start"}},[a("router-link",{staticClass:"el-button--text",attrs:{to:"/page/list",replace:""}},[t._v("页面管理")]),t._v("\n    / "+t._s(t.pageTitle)+"\n  ")],1),a("el-row",{staticStyle:{"margin-top":"30px"},attrs:{type:"flex",justify:"start"}},[a("el-form",{ref:"form",staticStyle:{width:"100%"},attrs:{model:t.form,rules:t.rules,"label-width":"100px","label-suffix":":","label-position":"left"}},[a("el-form-item",{attrs:{label:"页面名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入页面名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("h1",{staticStyle:{"font-size":"20px"}},[t._v("页面内容")]),t._l(t.form.page_items,function(e,i){return[e._destroy?t._e():a("el-form-item",{key:i,attrs:{label:"content"==e.item_type?"文字":"图片"}},[a("el-row",["content"==e.item_type?a("el-input",{staticClass:"content",attrs:{placeholder:"请输入文字",type:"textarea"},model:{value:e.content,callback:function(a){t.$set(e,"content",a)},expression:"item.content"}}):[e.image.url?a("div",{staticClass:"avatar"},[a("img",{attrs:{src:"https://szebra.cn"+e.image.url}}),a("i",{staticClass:"el-icon-circle-close",on:{click:function(e){t.removeImage(i)}}})]):a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://szebra.cn/api/admin/images","show-file-list":!1,"on-success":t.handleAvatarSuccess(i),name:"image[file]","before-upload":t.beforeAvatarUpload}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],a("el-button",{key:"btn"+i,staticClass:"delete-btn",attrs:{icon:"el-icon-delete",size:"small",type:"danger"},on:{click:function(e){t.deletePage(i)}}})],2),"content"!=e.item_type?a("el-row",{staticStyle:{"margin-top":"20px"}},[t._v("\n            公众号文章地址: "),a("el-input",{model:{value:e.link,callback:function(a){t.$set(e,"link",a)},expression:"item.link"}})],1):t._e()],1)]}),a("el-row",{staticStyle:{"margin-bottom":"30px","margin-top":"30px"}},[a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.addText}},[t._v("添加文字")]),a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.addImage}},[t._v("添加图片")])],1),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.submitBtnTitle))])],2)],1)],1)},r=[],n=(a("d85c"),a("3573"),a("a6b5")),s=a.n(n),o=a("f360"),l=a.n(o),c=a("44dd"),u=a.n(c),m=(a("175c"),a("bc97"),a("a5be"),{components:{},data:function(){return{pageState:"",pageTitle:"",pageId:"",submitBtnTitle:"",form:{id:"",name:"",page_items:[]},rules:{name:{required:!0,message:"请输入资讯标题名称",trigger:"blur"}}}},methods:{validateItems:function(){var t=!0,e=!1,a=void 0;try{for(var i,r=u()(this.form.page_items);!(t=(i=r.next()).done);t=!0){var n=i.value;if(!n._destroy)switch(n.item_type){case"content":if(!n.content)return void this.$message.error("文本内容不可为空");break;case"image":if(!n.image||!n.image.url||!n.image.id)return void this.$message.error("图片不可为空")}}}catch(s){e=!0,a=s}finally{try{t||null==r.return||r.return()}finally{if(e)throw a}}return!0},formatSubmitValue:function(){if(this.validateItems()){var t={id:this.form.id,page:l()({},this.form)};return t.page.page_items=t.page.id=void 0,t.page.page_items_attributes=this.form.page_items.map(function(t){return t=l()({},t),"image"===t.item_type&&(t.image_attributes=l()(t.image),t.image=void 0),t}),t}},deletePage:function(t){this.form.page_items[t]._destroy=!0,this.form.page_items.splice(t,this.form.page_items[t].id?0:1)},addText:function(){this.form.page_items.push({item_type:"content",content:"",position:this.form.page_items.length})},addImage:function(){this.form.page_items.push({item_type:"image",image:{id:"",url:""},position:this.form.page_items.length})},submit:function(){var t=this,e=this.formatSubmitValue();console.log(s()(e)),e&&this.$http[this.submitFuncName](e).then(function(e){0==e.data.retcode?(t.$message.success("保存成功"),l()(t.form,e.data.result_rows),t.$router.push({path:"/page/list"})):t.$message.error("保存失败")})},onSubmit:function(){var t=this;this.$refs.form.validate().then(function(e){return t.submit()}).catch(function(){})},deleteTextImage:function(){},removeImage:function(t){this.form.page_items[t].image.url=""},handleAvatarSuccess:function(t){var e=this;return function(a){return e.form.page_items[t].image=a.result_rows}},beforeAvatarUpload:function(t){var e=t.type.startsWith("image/"),a=t.size/1024/1024<2;return e||this.$message.error("只允许上传图片"),a||this.$message.error("上传图片大小不能超过 2MB!"),e&&a}},created:function(){var t=this;switch(this.$router.currentRoute.name){case"page_create":this.pageTitle="添加页面",this.submitBtnTitle="提交",this.submitFuncName="pageCreate";break;default:this.pageTitle="编辑页面",this.submitBtnTitle="保存所有编辑结果",this.submitFuncName="pageUpdate",this.$http.pageDetail(this.$router.currentRoute.params).then(function(e){e&&l()(t.form,e.data.result_rows)})}}}),p=m,f=(a("ea50"),a("25c1")),g=Object(f["a"])(p,i,r,!1,null,null,null);g.options.__file="detail.vue";e["default"]=g.exports},f360:function(t,e,a){t.exports=a("bdcc")}}]);
//# sourceMappingURL=chunk-342e781f.1b986f00.js.map