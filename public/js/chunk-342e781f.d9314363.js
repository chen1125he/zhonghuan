(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-342e781f"],{3573:function(t,e,i){"use strict";var a=i("ac1b"),r=i("5b7f"),n=i("3a08"),s="startsWith",o=""[s];a(a.P+a.F*i("7d31")(s),"String",{startsWith:function(t){var e=n(this,t,s),i=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),a=String(t);return o?o.call(e,a,i):e.slice(i,i+a.length)===a}})},"3a08":function(t,e,i){var a=i("f83a"),r=i("346b");t.exports=function(t,e,i){if(a(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(r(t))}},"3cfd":function(t,e,i){},"44dd":function(t,e,i){t.exports=i("67a8")},"67a8":function(t,e,i){i("0862"),i("a8ce"),t.exports=i("68bb")},"68bb":function(t,e,i){var a=i("90a5"),r=i("0749");t.exports=i("332a").getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return a(e.call(t))}},"7d31":function(t,e,i){var a=i("b816")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[a]=!1,!"/./"[t](e)}catch(r){}}return!0}},ea50:function(t,e,i){"use strict";var a=i("3cfd"),r=i.n(a);r.a},eace:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container",staticStyle:{margin:"15px 15px"}},[i("el-row",{staticStyle:{"font-size":"16px",color:"#303133"},attrs:{type:"flex",justify:"start"}},[i("router-link",{staticClass:"el-button--text",attrs:{to:"/page/list",replace:""}},[t._v("页面管理")]),t._v("\n    / "+t._s(t.pageTitle)+"\n  ")],1),i("el-row",{staticStyle:{"margin-top":"30px"},attrs:{type:"flex",justify:"start"}},[i("el-form",{ref:"form",staticStyle:{width:"100%"},attrs:{model:t.form,rules:t.rules,"label-width":"100px","label-suffix":":","label-position":"left"}},[i("el-form-item",{attrs:{label:"页面名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入页面名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("h1",{staticStyle:{"font-size":"20px"}},[t._v("页面内容")]),t._l(t.form.page_items,function(e,a){return[e._destroy?t._e():i("el-form-item",{key:a,attrs:{label:"content"==e.item_type?"文字":"图片"}},[i("el-row",["content"==e.item_type?i("el-input",{staticClass:"content",attrs:{placeholder:"请输入文字",type:"textarea"},model:{value:e.content,callback:function(i){t.$set(e,"content",i)},expression:"item.content"}}):[e.image.url?i("div",{staticClass:"avatar"},[i("img",{attrs:{src:"https://szebra.cn"+e.image.url}}),i("i",{staticClass:"el-icon-circle-close",on:{click:function(e){t.removeImage(a)}}})]):i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://szebra.cn/api/admin/images","show-file-list":!1,"on-success":t.handleAvatarSuccess(a),name:"image[file]","before-upload":t.beforeAvatarUpload}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],i("el-button",{key:"btn"+a,staticClass:"delete-btn",attrs:{icon:"el-icon-delete",size:"small",type:"danger"},on:{click:function(e){t.deletePage(a)}}})],2),"content"!=e.item_type?i("el-row",{staticStyle:{"margin-top":"20px"}},[t._v("\n            公众号文章地址: "),i("el-input",{model:{value:e.link,callback:function(i){t.$set(e,"link",i)},expression:"item.link"}})],1):t._e()],1)]}),i("el-row",{staticStyle:{"margin-bottom":"30px","margin-top":"30px"}},[i("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.addText}},[t._v("添加文字")]),i("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.addImage}},[t._v("添加图片")])],1),i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.submitBtnTitle))])],2)],1)],1)},r=[],n=(i("d85c"),i("3573"),i("a6b5")),s=i.n(n),o=i("f360"),l=i.n(o),c=i("44dd"),u=i.n(c),m=(i("175c"),i("bc97"),i("a5be"),{components:{},data:function(){return{pageState:"",pageTitle:"",pageId:"",submitBtnTitle:"",form:{id:"",name:"",page_items:[]},rules:{name:{required:!0,message:"请输入资讯标题名称",trigger:"blur"}}}},methods:{validateItems:function(){var t=!0,e=!1,i=void 0;try{for(var a,r=u()(this.form.page_items);!(t=(a=r.next()).done);t=!0){var n=a.value;if(!n._destroy)switch(n.item_type){case"content":if(!n.content)return void this.$message.error("文本内容不可为空");break;case"image":if(!n.image||!n.image.url||!n.image.id)return void this.$message.error("图片不可为空")}}}catch(s){e=!0,i=s}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}return!0},formatSubmitValue:function(){if(this.validateItems()){var t={id:this.form.id,page:l()({},this.form)};return t.page.page_items=t.page.id=void 0,t.page.page_items_attributes=this.form.page_items.map(function(t){return t=l()({},t),"image"===t.item_type&&(t.image_attributes=l()(t.image),t.image=void 0),t}),t}},deletePage:function(t){this.form.page_items[t]._destroy=!0,this.form.page_items.splice(t,this.form.page_items[t].id?0:1)},addText:function(){this.form.page_items.push({item_type:"content",content:"",position:this.form.page_items.length})},addImage:function(){this.form.page_items.push({item_type:"image",image:{id:"",url:""},position:this.form.page_items.length})},submit:function(){var t=this,e=this.formatSubmitValue();console.log(s()(e)),e&&this.$http[this.submitFuncName](e).then(function(e){e&&(l()(t.form,e.data.result_rows),t.$message.success("保存成功"))})},onSubmit:function(){var t=this;this.$refs.form.validate().then(function(e){return t.submit()}).catch(function(){})},deleteTextImage:function(){},removeImage:function(t){this.form.page_items[t].image.url=""},handleAvatarSuccess:function(t){var e=this;return function(i){return e.form.page_items[t].image=i.result_rows}},beforeAvatarUpload:function(t){var e=t.type.startsWith("image/"),i=t.size/1024/1024<5;return e||this.$message.error("只允许上传图片"),i||this.$message.error("上传图片大小不能超过 5MB!"),e&&i}},created:function(){var t=this;switch(this.$router.currentRoute.name){case"page_create":this.pageTitle="添加页面",this.submitBtnTitle="提交",this.submitFuncName="pageCreate";break;default:this.pageTitle="编辑页面",this.submitBtnTitle="保存所有编辑结果",this.submitFuncName="pageUpdate",this.$http.pageDetail(this.$router.currentRoute.params).then(function(e){e&&l()(t.form,e.data.result_rows)})}}}),p=m,f=(i("ea50"),i("25c1")),g=Object(f["a"])(p,a,r,!1,null,null,null);g.options.__file="detail.vue";e["default"]=g.exports},f360:function(t,e,i){t.exports=i("bdcc")}}]);
//# sourceMappingURL=chunk-342e781f.d9314363.js.map